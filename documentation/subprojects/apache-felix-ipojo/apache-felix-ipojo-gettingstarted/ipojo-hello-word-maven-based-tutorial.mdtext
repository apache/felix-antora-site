translation_pending: true
Title: iPOJO Hello Word (Maven-Based) tutorial



# iPOJO Hello World

*This page presents how to use the iPOJO runtime and its associated service component model. The concepts of the service component model are introduced, followed by a simple example that demonstrates the features of iPOJO.*

## Introduction

iPOJO aims to simplify service-oriented programming on OSGi frameworks; the name iPOJO is an abbreviation for *injected POJO*. iPOJO provides a new way to develop OSGi service components with the main goal being to simplify service component implementation by transparently managing the dynamics of the environment as well as other non-functional requirements. The iPOJO framework allows developers to more clearly separate functional code (i.e., the POJO) from the non-functional code (i.e., dependency management, service provision, configuration, etc.). iPOJO combines the functional and non-functional aspects at run time. To achieve this, iPOJO provides a simple and extensible service component model based on POJOs.

## The POJO concept

POJO is an acronym for Plain Old Java Object, but it embodies a concept that the simpler and less intrusive the design of a given framework, the better. The name is used to emphasize that a given object is not somehow special, but is an ordinary Java Object. Martin Fowler, Rebecca Parsons and Josh Mackenzie coined the term POJO in September 2000: "We wondered why people were so against using regular objects in their systems and concluded that it was because simple objects lacked a fancy name. So we gave them one, and it's caught on very nicely." From the developer's perspective, the iPOJO framework strives to only require POJOs in as much as it is possible.

## iPOJO service component overview

A service component is able to provide and/or require services, where a service is an object that implements a given service interface embodied as a Java interface. In addition, iPOJO introduces a callback concept to notify a component about various state changes.

The component is the central concept in iPOJO. In the core iPOJO model, a component describes service dependencies, provided services, and callbacks; this information is recorded in the component's metadata. Then, the second important concept in iPOJO is component instances. A component instances is a special *version* of the component. By merging component metadata and instance configuration, the iPOJO runtime is able to manage the component, i.e., manage its life cycle, inject required services, publish provided services, discover needed services.

## A simple example

The following is a simple example illustrating how to use the core iPOJO concepts. The example is comprised of two components, one providing a *Hello* service and one requiring any number of *Hello* services. The components are packaged into three different bundles using Maven. The *hello.service* bundle contains the service interface. The *hello.impl* bundle contains a component implementing the service. The *hello.client* bundle contains the consumer component.

Download the tutorial archive [here](maven-tutorial.zip). This archive contains a version of Felix (configured with iPOJO), and the projects explained below.

### Preparing Maven & Installing the tutorial

The first step is to download and install Maven; the example was created using Maven 2.1+. Once maven is installed on your machine, you can compile the tutorial by unzipping the archive, and by launching the `mvn clean install` command at the root of tutorial.

*Be aware that Maven outputs a lot of information while it executes and often downloads a lot of required JAR files into its local repository.*

### Hello Service

The first project is the *hello.service* project. This project contains only the *hello* service interface. Look at the `src/main/java/ipojo/example/hello/Hello.java` file:

    :::java
    /**
     * Hello Interface.
     * @author <a href="mailto:dev@felix.apache.org">Felix Project Team</a>
     */
    public interface Hello {

        /**
         * Returns a message like: "Hello $user_name".
         * @param name the name
         * @return the hello message
         */
        String sayHello(String name);
    }

    
In the project directory, the pom.xml file contains the instructions to build the bundle. The bundle uses the _maven-bundle-plugin_ (see here for more information on this plug-in).

<div class="pom"><p>&lt;project&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;packaging&gt;bundle&lt;/packaging&gt;<br>
&nbsp;&nbsp;&nbsp; <font color="#ff0000">&lt;groupId&gt;ipojo.example&lt;/groupId&gt;</font><br>
<font color="#ff0000">&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;hello.service&lt;/artifactId&gt;</font><br>
<font color="#ff0000">&nbsp;&nbsp;&nbsp; &lt;version&gt;1.0.0&lt;/version&gt;</font><br>
<font color="#ff0000">&nbsp;&nbsp;&nbsp; &lt;name&gt;Hello Service&lt;/name&gt;</font></p>

<p>&lt;build&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;plugins&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;plugin&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;version&gt;2.0.1&lt;/version&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;extensions&gt;true&lt;/extensions&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;configuration&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;instructions&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;Bundle-SymbolicName&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ${pom.artifactId}<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/Bundle-SymbolicName&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <font color="#ff0000">&lt;Export-Package&gt;</font><br>
<font color="#ff0000">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ipojo.example.hello</font><br>
<font color="#ff0000">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/Export-Package&gt;</font><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/instructions&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/configuration&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/plugin&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;/plugins&gt;<br>
&lt;/build&gt;</p>

<p>&lt;/project&gt;</p></div>

Then, the project is ready to be built issuing the following Maven command inside the project directory:

    :::sh
    mvn clean install

Maven should report that the build was a success; if an error was reported then verify the previous steps. Upon success the _Hello_ service component JAR file is installed into the local Maven repository. A copy of the bundle JAR file will also be present in the "target" directory inside the project directory.
    
### Hello Service Provider
    
The component implementation of the service is a simple Java class implementing the _Hello_ service interface. The implementation is in the _hello.impl_ project. The file `src/main/java/ipojo/example/hello/impl/HelloImpl.java` contains the following service implementation:

    :::java
    /**
     * Component implementing the Hello service.
     * @author <a href="mailto:dev@felix.apache.org">Felix Project Team</a>
     */
    public class HelloImpl implements Hello {
    
        /**
         * Returns an 'Hello' message.
         * @param name : name
         * @return Hello message
         * @see ipojo.example.hello.Hello#sayHello(java.lang.String)
         */
        public String sayHello(String name) { return "hello " + name;  }
    }

To manage the component, iPOJO needs some metadata to understand that the component provides the *Hello* service. iPOJO metadata file is at the root of the *hello.impl* project ("metadata.xml"). It contains the following metadata (Note: iPOJO also supports a JAR manifest-based syntax):

    :::xml
    <?xml version="1.0" encoding="UTF-8"?>
    <ipojo 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="org.apache.felix.ipojo http://felix.apache.org/ipojo/schemas/CURRENT/core.xsd" 
        xmlns="org.apache.felix.ipojo">
          
      <component classname="ipojo.example.hello.impl.HelloImpl"
        name="HelloProvider">
        <provides />
      </component>
      
      <instance component="HelloProvider" name="HelloService" />
    </ipojo>

In the above XML-based metadata, the *component* element has a mandatory '*classname'*attribute. This attribute tells iPOJO the implementation class of the component. Since the component in this example provides a service, the component element also specifies a child '*provides*' element. The '*provides*' element informs iPOJO that it must manage the publishing of a service. When the '*provides*' element does not contain an interface attribute, as is the case in this example, iPOJO will expose all implemented interfaces of the component as a service; it is also possible to specify the precise service interface. The '*instance*' element asks iPOJO to create an instance of your component when the bundle is started.

Finally, the `pom.xml` file contains instructions to build the bundle:

<div class="pom"><p>&lt;project&gt;<br>
&nbsp;&nbsp;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br>
&nbsp; &lt;packaging&gt;bundle&lt;/packaging&gt;<br>
&nbsp;&nbsp;<font color="red">&lt;groupId&gt;ipojo.example&lt;/groupId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&lt;artifactId&gt;hello.impl&lt;/artifactId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&lt;version&gt;1.0.0&lt;/version&gt;</font></p>

<p>&nbsp;&nbsp;<font color="red">&lt;name&gt;Hello Service Provider&lt;/name&gt;</font></p>

<p><font color="red">&nbsp; &lt;dependencies&gt;</font><br>
<font color="red">&nbsp;&nbsp; &nbsp;&lt;dependency&gt; &lt;!--Compilation (i.e. class) dependency on the service interface --&gt;</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;groupId&gt;ipojo.example&lt;/groupId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;artifactId&gt;hello.service&lt;/artifactId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;version&gt;</font><font color="#ff0000">1.0.0</font><font color="red">&lt;/version&gt;</font><br>
<font color="red">&nbsp;&nbsp; &nbsp;&lt;/dependency&gt;</font><br>
<font color="red">&nbsp; &lt;/dependencies&gt;</font></p>


<p>&nbsp;&nbsp;&lt;build&gt;<br>
&nbsp;&nbsp; &lt;plugins&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;plugin&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;version&gt;2.0.1&lt;/version&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;extensions&gt;true&lt;/extensions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;configuration&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;instructions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Bundle-SymbolicName&gt;${pom.artifactId}&lt;/Bundle-SymbolicName&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="red">&lt;Private-Package&gt;ipojo.example.hello.impl&lt;/Private-Package&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/instructions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/configuration&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/plugin&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;plugin&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;maven-ipojo-plugin&lt;/artifactId&gt;<br>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;version&gt;1.6.0&lt;/version&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;executions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;execution&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;goals&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;goal&gt;ipojo-bundle&lt;/goal&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/goals&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&lt;/execution&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/executions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/plugin&gt;<br>
&nbsp;&nbsp; &lt;/plugins&gt;<br>
&nbsp;&lt;/build&gt;<br>
&lt;/project&gt;</p></div>

The text highlighted in <span style="color:red">red</span> above indicates the important information related to the project. The first part of the POM file indicates that the packaging format is an iPOJO bundle and also includes some information about the project (name, groupId, and artifactId). This information is not used by iPOJO, but is used by Maven. The rest of the POM file contains the bundle configuration. In the *instructions* element, you need to enter the bundle name, the bundle description, and the exported packages. The service provider bundle exports the package of *Hello* interface.

Then, the project is ready to be built issuing the following Maven command inside the project directory:

    :::sh
    mvn clean install

Maven should report that the build was a success; if an error was reported then verify the previous steps. Upon success the *Hello* service component JAR file is installed into the local Maven repository. A copy of the bundle JAR file will also be present in the "target" directory inside the project directory.

### Hello Service Client

The Hello service consumer is inside the *hello.client* project. The file `src/main/java/ipojo/example/hello/client/HelloClient.java` contains the following *Hello* service client:

    :::java
    package ipojo.example.hello.client;

    import ipojo.example.hello.Hello;

    /**
     * Hello Service simple client.
     * @author <a href="mailto:dev@felix.apache.org">Felix Project Team</a>
     */
    public class HelloClient implements Runnable {

        /**
         *  Delay between two invocations.
         */
        private static final int DELAY = 10000;

        /**
         * Hello services.
         * Injected by the container.
         * */
        private Hello[]({{ refs..path }}) m_hello;

        /**
         * End flag.
         *  */
        private boolean m_end;

        /**
         * Run method.
         * @see java.lang.Runnable#run()
         */
        public void run() {
            while (!m_end) {
                try {
                    invokeHelloServices();
                    Thread.sleep(DELAY);
                } catch (InterruptedException ie) {
                    /* will recheck end */
                }
            }
        }

        /**
         * Invoke hello services.
         */
        public void invokeHelloServices() {
            for (int i = 0; i < m_hello.length; i++) {
                // Update with your name.
                System.out.println(m_hello[i]({{ refs.i.path }}).sayHello("world"));
            }
        }

        /**
         * Starting.
         */
        public void starting() {
            Thread thread = new Thread(this);
            m_end = false;
            thread.start();
        }

        /**
         * Stopping.
         */
        public void stopping() {
            m_end = true;
        }
    }

The _Hello_ service client creates a thread that periodically invokes the available _Hello_ services. The thread starts when at least one _Hello_ service provider is present using iPOJO's call back mechanism. In the client code, to use the _hello_ the component implementation simply declares a field of the type of the service and then simply uses it directly in its code. In this example, it is the m_hello field is declared as the service field; notice that the field is an array of _Hello_. In iPOJO an array of services represents an aggregate or multiple cardinality dependency, whereas if a scalar value represents a singular or unary cardinality dependency. In other words, for a singular dependency simply remove the array brackets from the example (e.g., HelloService m_hello[]. After declaring a field for the service, the rest of the component code can simply assume that the service field will be initialized, e.g., m_hello[i].sayHello("world").
    
Notice that iPOJO manages service synchronization too. So, the service invocations do not require synchronization blocks. This synchronization is maintained on a per thread basis, where each method that accesses a service is instrumented to attach the given service instance to the thread so that the thread will continue to see the same service instances even across nested method invocations. The thread will not see different service instances until it completely exits from the first method it entered which used a services. Thus, you would not want to access services in the {{run()}} method above, because the thread would always see the same service instance.
    
The component provides two callback methods for its activation and deactivation, starting() and stopping(), respectively. Callbacks are used when the component needs to be informed about a component state change. In iPOJO, the component state is either *INVALID* (i.e., not all of the component's constraints are satisfied) or *VALID* (i.e., all of the component's constraints are satisfied). In this example, the starting callback method creates and starts a thread; the stopping callback method stops the thread. The component metadata will instruct iPOJO to invoke these methods when the component's state changes to *VALID* or *INVALID* respectively.
    
The iPOJO metadata file describing the component is "metadata.xml" and contains the following metadata:

    :::xml
    <?xml version="1.0" encoding="UTF-8"?>
    <ipojo 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="org.apache.felix.ipojo http://felix.apache.org/ipojo/schemas/CURRENT/core.xsd" 
        xmlns="org.apache.felix.ipojo">
    
      <component classname="ipojo.example.hello.client.HelloClient">
        <requires field="m_hello" />
        <callback transition="validate" method="starting" />
        <callback transition="invalidate" method="stopping" />
        <properties>
          <property field="m_name" name="hello.name" />
        </properties>
      </component>
    
      <instance component="ipojo.example.hello.client.HelloClient">
        <property name="hello.name" value="clement" />
      </instance>
    </ipojo>

The component element again has the '*classname'* attribute that refers to the component implementation class. The '*requires*' element describes the *Hello* service dependency by simply specifying its associated component field. The '*callback'*elements describe which method to invoke when the component's state changes. Then the '*instance*' element asks iPOJO to create an instance of the component (notice that no instance name is provided here, iPOJO will give an instance name to the instance automatically).

Finally, the `pom.xml` file contains instructions to build the bundle:

<div class="pom"><p>&lt;project&gt;<br>
&nbsp;&nbsp;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br>
&nbsp;&nbsp;&lt;packaging&gt;bundle&lt;/packaging&gt;<br>
&nbsp;&nbsp;<font color="red">&lt;groupId&gt;ipojo.example&lt;/groupId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&lt;artifactId&gt;hello.client&lt;/artifactId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&lt;version&gt;1.0.0&lt;/version&gt;</font><br>
<font color="red">&nbsp;&nbsp;&lt;name&gt;Hello Client&lt;/name&gt;</font></p>

<p><font color="red">&nbsp;&nbsp;&lt;dependencies&gt;</font><br>
<font color="red">&nbsp;&nbsp; &nbsp;&lt;dependency&gt; &lt;!--</font> <font color="red">Compilation (i.e. class) dependency on the service interface --</font><font color="red">&gt;</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;groupId&gt;ipojo.example&lt;/groupId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;artifactId&gt;hello.service&lt;/artifactId&gt;</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&lt;version&gt;</font><font color="#ff0000">1.0.0</font><font color="red">&lt;/version&gt;</font><br>
<font color="red">&nbsp;&nbsp; &nbsp;&lt;/dependency&gt;</font><br>
<font color="red">&nbsp; &lt;/dependencies&gt;</font></p>

<p>&nbsp; &lt;build&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;plugins&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;plugin&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;version&gt;2.0.1&lt;/version&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;extensions&gt;true&lt;/extensions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;configuration&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;instructions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Bundle-SymbolicName&gt;${pom.artifactId}&lt;/Bundle-SymbolicName&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="red">&lt;Private-Package&gt;ipojo.example.hello.client&lt;/Private-Package&gt;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/instructions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/configuration&gt;<br>
&nbsp;&nbsp; &lt;/plugin&gt;<br>
&nbsp;&nbsp; &lt;plugin&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;maven-ipojo-plugin&lt;/artifactId&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &lt;version&gt;1.6.0&lt;/version&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;executions&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;execution&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;goals&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;goal&gt;ipojo-bundle&lt;/goal&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/goals&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/execution&gt;<br>
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/executions&gt;<br>
&nbsp;&nbsp; &lt;/plugin&gt;<br>
&nbsp;&lt;/plugins&gt;<br>
&nbsp; &lt;/build&gt;<br>
&lt;/project&gt;</p></div>

The text highlighted in <span style="color:red">red</code> above indicates the information related to the project. The *dependencies* element tells Maven that the client bundle has a compilation dependency on the service provider bundle. In this case, the client bundle needs the *Hello* service interface to compile. After building the service provider bundle JAR file, Maven installs it into a local repository on your machine. To resolve compilation dependencies, Maven looks in the local repository to find required JAR files.
After the skeleton "pom.xml" file is modified, the project is ready to be built issuing the following Maven command inside the project directory:
    
    :::sh
    mvn clean install

Maven should report that the build was a success; if an error was reported then verify the previous steps. Upon success the *Hello* service component JAR file is installed into the local Maven repository. A copy of the bundle JAR file will also be present in the "target" directory inside the project directory.

## Running the example

To run the example, start Felix. A distribution of Felix is provided in the felix-1.0.3 directory. This version is configured to launch iPOJO automatically. From the Felix directory, launch the following command to start the framework
    
    :::sh
    java -jar bin/felix.jar

You can check installed bundles by using the '*ps'* command:
    
    :::sh
    -> ps
    START LEVEL 1
       ID   State         Level  Name
    [   0] [Active     ] [    0] System Bundle (2.0.5)
    [   1] [Active     ] [    1] Apache Felix Bundle Repository (1.4.3)
    [   2] [Active     ] [    1] Apache Felix iPOJO ({{ipojo.release}})
    [   3] [Active     ] [    1] Apache Felix iPOJO Arch Command (1.6.0)
    [   4] [Active     ] [    1] Apache Felix Shell Service (1.4.2)
    [   5] [Active     ] [    1] Apache Felix Shell TUI (1.4.1)
    ->

iPOJO runtime is the bundle 4. The bundle 5 is a Felix shell command allowing the introspection of iPOJO component instances (see herefor further information).

Install the Hello service bundle, the *Hello* service provider and the client that were created above:

    :::sh
    start file:../hello.service/target/hello.service-1.0.0.jar
    start file:../hello.impl/target/hello.impl-1.0.0.jar
    start file:../hello.client/target/hello.client-1.0.0.jar

By starting the *Hello* service provider bundle, the client component will automatically be activated. So, the *'hello world'* messages are displayed.

    :::sh
    -> hello world
    hello world

Stop the provider (with the '*stop 7*' command) and the client will automatically be deactivated since its dependency is no longer valid. If multiple Hello services are deployed, the client will connect to all of them. If you restart the bundle (with the *start 7* command), the client becomes valid.

During these operations, you can use the arch command to check the state of instances.
    
<div class="shell"><p>-&gt; stop 7<br>
-&gt; arch<br>
Instance ArchCommand -&gt; valid<br>
<font color="red">Instance ipojo.example.hello.client.HelloClient-0 -&gt; invalid</font><br>
-&gt; arch -instance ipojo.example.hello.client.HelloClient-0<br>
instance name="ipojo.example.hello.client.HelloClient-0" <br>
&nbsp;component.type="ipojo.example.hello.client.HelloClient" <br>
&nbsp;state="<font color="red">invalid</font>" bundle="8"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object name="ipojo.example.hello.client.HelloClient@137c60d"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="red">handler name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler" state="invalid"</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="red">requires aggregate="true" optional="false" state="resolved" specification="ipojo.example.hello.Hello"</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler name="org.apache.felix.ipojo.handlers.lifecycle.callback.LifecycleCallbackHandler" state="valid"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler" state="valid"<br>
-&gt; start 7<br>
hello world<br>
-&gt; arch<br>
Instance ArchCommand -&gt; valid<br>
<font color="red">Instance ipojo.example.hello.client.HelloClient-0 -&gt; valid</font><br>
Instance HelloService -&gt; valid<br>
-&gt; arch -instance ipojo.example.hello.client.HelloClient-0<br>
instance name="ipojo.example.hello.client.HelloClient-0" <br>
&nbsp;component.type="ipojo.example.hello.client.HelloClient"<br>
&nbsp; state="valid" bundle="8"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; object name="ipojo.example.hello.client.HelloClient@137c60d"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="red">handler name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler" state="valid"</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="red">requires aggregate="true" optional="false" state="resolved" specification="ipojo.example.hello.Hello"</font><br>
<font color="red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="red">uses service.id="38" instance.name="HelloService"</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler name="org.apache.felix.ipojo.handlers.lifecycle.callback.LifecycleCallbackHandler" state="valid"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler" state="valid"</p></div>

## Conclusion
We saw how to use easily iPOJO to build service-oriented components. Subscribe to the Felix users mailing list by sending a message to [users-subscribe@felix.apache.org](mailto:users-subscribe@felix.apache.org); after subscribing, email questions or feedback to [users@felix.apache.org](mailto:users@felix.apache.org).
  
  
  
  
